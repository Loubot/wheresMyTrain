// Generated by CoffeeScript 1.6.3
(function() {
  var goBack, populateDisplayStation;

  $(document).on('pagebeforeshow', '#display_station_page', function() {
    var code;
    code = window.sessionStorage.getItem('stationCode');
    return $.ajax({
      url: "http://aqueous-reaches-7754.herokuapp.com/station_info.json",
      data: {
        data: code
      },
      type: 'get',
      dataType: 'json',
      timeout: 10000,
      success: function(result) {
        return populateDisplayStation(result);
      },
      error: function(error) {
        console.log('Display station get station info ajax failed ' + JSON.stringify(error));
        return navigator.notification.confirm('Server returned invalid code', goBack, 'Invlaid Station', ['Return']);
      }
    });
  });

  goBack = function() {
    return $.mobile.back({
      changeHash: true,
      transition: 'slide',
      reverse: true
    });
  };

  populateDisplayStation = function(json) {
    console.log('displayStation ajax success ' + JSON.stringify(json));
    $('#stationTitle').empty().append("" + json.coords.stationName);
    createMap(json.coords.lat, json.coords.lon, json.coords.stationName, 'stationMap');
    $('#stationTimeTable').empty();
    return $(json.station).each(function() {
      return $('#stationTimeTable').append("<a href=\"#\" onclick=\"displayThisTrain('" + this.code + "')\">" + this.origin + " to " + this.destination + " <br>Due at " + this.arrival + ", Departing " + this.depart + " </a><hr> ");
    });
  };

  window.displayThisTrain = function(trainCode) {
    window.sessionStorage.setItem('trainCode', trainCode);
    return $.mobile.changePage('../displayTrain/displayTrain.html', {
      transition: 'slide',
      changeHash: true
    });
  };

}).call(this);
