// Generated by CoffeeScript 1.7.1
(function() {
  var addStops;

  $(document).on('pagebeforeshow', '#display_train_page', function() {
    var trainCode;
    trainCode = window.sessionStorage.getItem('trainCode');
    console.log('displayTrain info ' + trainCode);
    return $.ajax({
      url: 'http://aqueous-reaches-7754.herokuapp.com/train_info.json',
      data: {
        data: trainCode
      },
      dataType: 'json',
      timeout: 10000,
      success: function(result) {
        return addStops(result);
      },
      error: function(error) {
        return console.log('displayTrain error ' + JSON.stringify(error));
      }
    });
  });

  addStops = function(stopsInfo) {
    console.log('stops info ' + JSON.stringify(stopsInfo));
    $('#displayTrain').empty().append("" + stopsInfo.coords.desc);
    createMap(stopsInfo.coords.lat, stopsInfo.coords.lon, stopsInfo.coords.desc, 'mapContainer');
    return $(stopsInfo.stops).each(function() {
      return $('#trainStops').append("<a href=\"#\" onclick=\"getStationInfo('" + this.stopCode + "')\">" + this.stop + ": Expected arrival: " + this.exArrival + ", Expected departure: " + this.exDepart + "</p>");
    });
  };

  window.getStationInfo = function(code) {
    alert(code);
    window.sessionStorage.setItem('stationCode', code);
    return $.mobile.changePage('../displayStation/displayStation.html', {
      transition: 'slide',
      changeHash: true
    });
  };

}).call(this);
