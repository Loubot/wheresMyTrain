// Generated by CoffeeScript 1.7.1
(function() {
  var failedCoords, gotCoords, populateNearbyStationsMap;

  $(document).on('pagebeforeshow', '#nearby_stations_page', function() {
    $('#nearby_stations_page').on('scrollstart', function(e) {
      return e.preventDefault();
    });
    return navigator.geolocation.getCurrentPosition(gotCoords, failedCoords, {
      timeout: 10000,
      enableHighAccuracy: true
    });
  });

  gotCoords = function(position) {
    return $.ajax({
      url: 'http://10.0.2.2:3000/close_stations.json',
      type: 'get',
      dataType: 'json',
      data: {
        coords: [position.coords.longitude, position.coords.latitude]
      },
      timeout: 10000,
      success: function(json) {
        console.log('nearbyStations ajax success' + JSON.stringify(json));
        return populateNearbyStationsMap(json, position);
      },
      error: function(error) {
        return console.log('nearbyStations ajax failure' + JSON.stringify(error));
      }
    });
  };

  failedCoords = function(error) {
    console.log('geolocation error ' + error);
    return navigator.notification.confirm('Faied to get location', null, 'Bad location', ['Continue']);
  };

  populateNearbyStationsMap = function(stations, position) {
    return createMap(position.coords.longitude, position.coords.latitude, 'You are here', 'nearbyStationsMap');
  };

}).call(this);
